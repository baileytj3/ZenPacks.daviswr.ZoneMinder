name: ZenPacks.daviswr.ZoneMinder

class_relationships:
  - Products.ZenModel.Device.Device(zoneMinder) 1:MC ZoneMinder(server)
  - ZoneMinder(zmMonitors) 1:MC ZMMonitor(zoneMinder)
  - ZoneMinder(zmServers) 1:MC ZMServer(zoneMinder)
  - ZoneMinder(zmStorage) 1:MC ZMStorage(zoneMinder)

classes:
  DEFAULTS:
    base: [zenpacklib.Component]

  ZoneMinder:
    label: ZoneMinder Daemon
    plural_label: ZoneMinder Daemon
    short_label: ZM Daemon
    plural_short_label: ZM Daemon
    relationships:
      zmServers:
        grid_display: false
        details_display: false
      zmStorage:
        grid_display: false
        details_display: false
    properties:
      DEFAULTS:
        type: string
        grid_display: false
      version:
        label: Version
        grid_display: true
        order: 2
      apiversion:
        label: API Version
        order: 13
      # What the effective current version of ZoneMinder is,
      # might be different from actual if versions ignored
      ZmDynCurrVersion:
        label: Effective Version
        order: 11
      # What the version of the database is, from zmupdate
      ZmDynDbVersion:
        label: Database Version
        order: 12
      # The email address to send matching event details to
      ZmEmailAddress:
        label: Email Address
        order: 14
      # The email address to send matching event details to
      ZmMessageAddress:
        label: Message Address
        order: 15
      # The email address you wish your event notifications to originate from
      ZmFromEmail:
        label: From Email Address
        order: 16
      # The host address of your SMTP mail server
      ZmEmailHost:
        label: Email Host
        default: localhost
        order: 17
      # Is the ffmpeg video encoder/decoder installed
      ZmOptFfmpeg:
        label: FFmpeg Support
        short_label: FFmpeg
        type: boolean
        default: false
        enum: {true: "clear", false: "debug"}
        renderer: Zenoss.render.severity
        grid_display: true
        details_display: false
        label_width: 45
        order: 3
      # Path to (optional) ffmpeg mpeg encoder
      ZmPathFfmpeg:
        label: FFmpeg Path
        order: 18
      # Formats to allow for ffmpeg video generation
      ZmFfmpegFormats:
        label: FFmpeg Formats
        default: mpg mpeg wmv asf avi mov swf 3gp
        order: 19
      # Maximum number of log entries to retain
      ZmLogDatabaseLimit:
        label: Log Database Limit
        default: 7 day
        order: 21
      # Path to the various logs that the ZoneMinder daemons generate
      ZmPathLogs:
        label: Log Path
        default: /var/log/zm
        order: 20
      # enables a frame server daemon (zmf)
      # which will be sent the images from the analysis daemon
      ZmOptFrameServer:
        label: Frame Server
        short_label: ZMF
        type: boolean
        default: false
        enum: {true: "clear", false: "debug"}
        renderer: Zenoss.render.severity
        grid_display: true
        details_display: false
        label_width: 35
        order: 4
      

  ZMMonitor:
    label: ZoneMinder Monitor
    short_label: Monitor
    relationships:
      zoneMinder:
        grid_display: false
        details_display: false
    properties:
      DEFAULTS:
        type: string
        grid_display: false
      ServerId:
        label: Server ID
        type: int
        default: 0
        details_display: false
      MonitorType:
        label: Type
        grid_display: true
        order : 9
      Function:
        grid_display: true
        order: 8
      Enabled:
        type: boolean
        default: false
        enum: {true: "clear", false: "critical"}
        renderer: Zenoss.render.severity
        grid_display: true
        details_display: false
        label_width: 45
        order: 2
      Protocol:
        order: 6
      Method:
        order: 7
      Host:
        # Will have to remove passwords
        grid_display: true
        order: 3
      Port:
        type: int
        order: 4
      Path:
        # Will have to remove passwords from URL
        # May have to assemble with Host and Port depending on format
        label: URL
        order: 5
      Resolution:
        # Assembled from Width and Height attributes
        details_display: true
        order: 10 
      Width:
        type: int
        details_display: false
      Height:
        type: int
        details_display: false
      Controllable:
        label: PTZ Controls
        short_label: PTZ
        type: boolean
        default: false
        details_display: false
      ControlId:
        label: PTZ Type
        order: 14
      AnalysisFPS:
        label: Analysis FPS
        type: float
        order: 11
      MaxFPS:
        label: Max FPS
        type: float
        order: 12
      AlarmMaxFPS:
        label: Alarm Max FPS
        type: float
        order: 13
      

  # Different classes required for different monitor protocol health checks
  ZMHttpMonitor:
    base: [ZMMonitor]
    label: ZoneMinder HTTP Monitor
    short_label: HTTP Monitor

  ZMRtspMonitor:
    base: [ZMMonitor]
    label: ZoneMinder RTSP Monitor
    short_label: RTSP Monitor

  ZMHttpRtspMonitor:
    base: [ZMMonitor]
    label: ZoneMinder HTTP-RSTP Monitor
    short_label: HTTP-RSTP Monitor


  ZMServer:
    label: ZoneMinder Server
    short_label: ZM Server
    properties:
      DEFAULTS:
        grid_display: false 
      Hostname:
        type: string
        grid_display: true
        order: 2
      State_Id:
        label: State ID
        type: int
        default: 0
        details_display: false
      Status:
        # Will need a way to dynamically update this
        type: string
        details_display: false
      CpuLoad:
        label: CPU Load
        type: float
        default: 0.0
        #datapoint:
      TotalMem:
        label: Total Memory
        type: int
        renderer: Zenoss.render.bytesString
        default: 0
      FreeMem:
        label: Free Memory
        type: int
        renderer: Zenoss.render.bytesString
        default: 0
        #datapoint:
      TotalSwap:
        label: Total Swap Space
        type: int
        renderer: Zenoss.render.bytesString
        default: 0
      FreeSwap:
        label: Free Swap Space
        type: int
        renderer: Zenoss.render.bytesString
        default: 0
        #datapoint:
      zmstats:
        label: Stats
        type: boolean
        default: false
      zmaudit:
        label: Audit
        type: boolean
        default: false
      zmtrigger:
        label: Trigger
        type: boolean
        default: false

  ZMStorage:
    label: ZoneMinder Storage
    short_label: ZM Storage
    plural_label: ZoneMinder Storage
    plural_short_label: ZM Storage
    properties:
      DEFAULTS:
        type: string
        grid_display: false
        details_display: true
      Path:
        label: Path
        grid_display: true
        order: 2
      StorageType:
        label: Type
        order: 3
      Url:
        label: URL
        order: 4
      DiskSpace:
        label: Disk Space
        type: int
        renderer: Zenoss.render.bytesString
        grid_display: true
        order: 5
      Scheme:
        label: Scheme
        order: 6
      ServerId:
        label: Server ID
        type: int
        default: 0
        order: 7
      DoDelete:
        label: Do-Delete
        type: boolean
        order: 8


zProperties:
  DEFAULTS:
    category: ZoneMinder
  zZoneMinderUsername:
    type: string
  zZoneMinderPassword:
    type: password
  zZoneMinderHostname:
    type: string
  zZoneMinderPort:
    type: int
    default: 443
  zZoneMinderPath:
    type: string
    default: /zm/
  zZoneMinderSSL:
    type: boolean
    default: true
  zZoneMinderURL:
    type: string


device_classes:
  /:
    remove: false
    templates:
      ZoneMinderDaemon:
        targetPythonClass: ZenPacks.daviswr.ZoneMinder.ZoneMinder

        datasources:
          Daemon:
            type: Python
            plugin_classname: ZenPacks.daviswr.ZoneMinder.dsplugins.Daemon
            cycletime: 300

            datapoints:
              result: GAUGE
              load-1: GAUGE
              load-5: GAUGE
              load-15: GAUGE

        thresholds:
          Daemon-Status:
            #type: MinMaxThreshold
            type: ValueChangeThreshold
            enabled: true
            dsnames:
              - Daemon_result
            severity: 4
            eventClass: /Status
            #minval: 1
            #maxval: 1

        graphs:
          DEFAULTS:
            miny: 0
          Load:
            graphpoints:
              1-Minute Avg:
                dpName: Daemon_load-1
                lineType: AREA
                stacked: true
                colorindex: 0
              5-Minute Avg:
                dpName: Daemon_load-5
                lineType: LINE
                lineWidth: 2
                colorindex: 1
              15-Minute Avg:
                dpName: Daemon_load-15
                lineType: LINE
                lineWidth: 1
                colorindex: 1
